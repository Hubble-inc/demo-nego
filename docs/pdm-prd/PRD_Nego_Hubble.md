# HubbleNego Hubble連携利用 仕様書

> HubbleユーザーがNegoを使って契約交渉を行う場合のユーザーフローと画面仕様を定義します。
> 共通仕様（AI機能、バージョン管理、署名・締結フロー、交渉詳細画面等）は [PRD_Common.md](./PRD_Common.md) を参照してください。

---

## 1. 概要

### 1.1 このパターンの対象ユーザー
- 既存のHubbleユーザー
- 社内で契約書を管理しつつ、取引先との交渉にNegoを使いたいユーザー
- 社内コメントと交渉コメントを分けて管理したいユーザー

### 1.2 主な特徴
- **Hubbleが契約書の「マスター」** - バージョン管理の中心はHubble
- **Negoは「交渉レイヤー」** - 社外との交渉専用画面
- **コメントの分離** - 社内コメント（Hubble）と交渉コメント（Nego）が明確に分かれる
- **双方向同期** - HubbleとNegoでバージョンが自動同期

### 1.3 Nego単体利用との違い

| 項目 | Nego単体利用 | Hubble連携利用 |
|------|-------------|----------------|
| 契約書のマスター | Nego | Hubble |
| アップロード場所 | Negoに直接 | Hubble経由 |
| 社内コメント | なし（全員に見える） | Hubble側で管理（社外に見えない） |
| バージョン管理 | Nego内で完結 | Hubbleと同期 |
| 入口画面 | Negoダッシュボード | Hubbleの契約書画面 |

---

## 2. ユーザーフロー

### 2.1 Hubble側ユーザー（契約書オーナー）のフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│  [Hubbleで契約書作成]                                            │
│        │                                                         │
│        ↓                                                         │
│  [1. 交渉相手に共有]  →  [2. 招待]  →  [3. 交渉開始]            │
│        │                     │              │                    │
│        ↓                     ↓              ↓                    │
│   ツールバーの          メールor       Hubble内で状況確認        │
│   「交渉相手に共有」     リンクで招待   Nego画面で交渉            │
│   ボタンをクリック                                               │
│                                              │                   │
│                                              ↓                   │
│                               [4. 修正版受信] → [5. 署名・締結]   │
│                                    │               │             │
│                                    ↓               ↓             │
│                              Hubbleに自動反映  全員署名完了で     │
│                              新バージョン作成  契約締結           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 招待された側（交渉相手）のフロー

```
招待リンクを受信 → 契約書プレビュー確認 → サインイン → Negoで交渉に参加
                     (AI概要表示)      (Google/Microsoft)
```

※招待された側は通常のNego画面を使用（Hubbleを使わない）

---

## 3. 画面構成

### 3.1 画面一覧

| 画面名 | 説明 | ファイル |
|--------|------|---------|
| Hubble契約書画面（初回共有） | 交渉開始前のHubble画面 | hubble-ui-first-share.html |
| Hubble契約書画面（交渉中） | 交渉中のHubble画面 | hubble-ui.html |
| Nego交渉画面 | 交渉相手とのやり取り画面 | negotiation.html |

### 3.2 画面遷移図

```
[Hubble契約書画面（初回共有）]
         │
         │ 「交渉相手に共有」クリック
         ↓
     [招待モーダル]
         │
         │ 招待送信
         ↓
[Hubble契約書画面（交渉中）]  ←→  [Nego交渉画面]
         │                              │
         │ 「Negoを開く」               │
         └──────────────────────────────┘
```

---

## 4. Hubble契約書画面（初回共有前）

交渉を開始する前のHubble画面。

### 4.1 画面レイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│ Hubble    ドキュメント > シリーズB > 株主間契約書               │
├─────────────────────────────────────────────────────────────────┤
│ [更新] [DL] [UP] [印刷] │ [表示] [検索]   [交渉相手に共有] [Word編集]│
├─────────┬───────────────────────────────────────────┬───────────┤
│ Ver.    │                                           │ コメント  │
│         │                                           │           │
│ [3] ◉  │         契約書本文エリア                  │ 社内の    │
│  1/28   │                                           │ コメント  │
│ [2]     │                                           │ のみ表示  │
│  1/27   │                                           │           │
│ [1]     │                                           │           │
│  1/25   │                                           │           │
│         │                                           │           │
└─────────┴───────────────────────────────────────────┴───────────┘
```

### 4.2 ポイント
- **交渉バナーなし** - まだ交渉が始まっていない
- **ツールバーに「交渉相手に共有」ボタン** - オレンジのアウトラインスタイル
- **コメントは社内のみ** - 交渉コメントはまだない

---

## 5. 招待モーダル

「交渉相手に共有」ボタンクリックで表示。

### 5.1 モーダルレイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│  👥 交渉相手を招待                                        [×]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ──── 共有するバージョン ────                                    │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ 📄 株主間契約書                        Ver.3（最新）   │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ──── メールアドレスで招待 ────                                  │
│  [ tanaka@example.com              ] [+]                         │
│                                                                  │
│  ──── または ────                                                │
│  🔗 招待リンクをコピー                                           │
│  [ https://nego.app/join/x7k2mP... ] [コピー]                    │
│  💡 招待された方は契約書を閲覧できます。                         │
│     ※ 署名者は署名手続き・設定で別途指定します。                │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                              [キャンセル] [招待して交渉を開始]   │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 仕様
- 共有するバージョンを明示（現在選択中のバージョン）
- 招待された人はメンバーとして参加（署名者は署名手続き・設定で別途指定）
- メールアドレス入力 + 招待リンクの2つの招待方法

---

## 6. Hubble契約書画面（交渉中）

交渉開始後のHubble画面。上部にバナーが表示される。

### 6.1 画面レイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│ 🟠 交渉中 ｜ Ver.4を共有中                      [Negoを開く →] │
├─────────────────────────────────────────────────────────────────┤
│ Hubble    ドキュメント > シリーズB > 株主間契約書               │
├─────────────────────────────────────────────────────────────────┤
│ [更新] [DL] [UP] [印刷] │ [表示] [検索]   [交渉相手に共有] [Word編集]│
├─────────┬───────────────────────────────────────────┬───────────┤
│ Ver.    │                                           │ コメント  │
│         │                                           │           │
│ [5]     │         契約書本文エリア                  │ 社内 +    │
│  🔶→    │                                           │ 交渉      │
│ [4] ◉  │                                           │ コメント  │
│  🔵←    │                                           │ 表示      │
│ [3]     │                                           │           │
│  🔵→    │                                           │           │
│         │                                           │           │
└─────────┴───────────────────────────────────────────┴───────────┘
```

### 6.2 交渉バナー

ページ最上部（ヘッダーの上）に表示されるオレンジ色のバナー。

| 要素 | 説明 |
|------|------|
| アイコン | 🟠（オレンジ丸） |
| ステータス | 「交渉中」「返答待ち」「署名中」「締結済み」など |
| 共有バージョン | 「Ver.4を共有中」 |
| アクション | 「Negoを開く →」リンク |

### 6.3 バージョンリストの表示

交渉に関わるバージョンにはアイコンを表示。

| アイコン | 意味 |
|---------|------|
| 🔵→ | 自分が相手に共有したバージョン |
| 🔶← | 相手から受け取ったバージョン |
| （なし） | 交渉に関係ないバージョン（社内のみ） |

### 6.4 コメントの表示

| コメントタイプ | スタイル | 説明 |
|---------------|---------|------|
| 社内コメント | 背景なし、線なし | Hubble内の社内向けコメント |
| 交渉コメント | オレンジ左線 + オレンジ背景 | Negoでの交渉相手とのコメント |

```
┌─────────────────────────────────────┐
│ 田中（法務） 1/28 11:30             │   ← 社内コメント（装飾なし）
│ レビュー完了しました。              │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ ▌山田（相手先） 1/28 14:00  via Nego│   ← 交渉コメント（オレンジ線+背景）
│ ▌第3条について確認させてください。  │
│ ▌                                   │
│ ▌        [Negoで返信する]           │
└─────────────────────────────────────┘
```

---

## 7. Hubble↔Nego間のバージョン同期

### 7.1 同期の仕組み

```
    Hubble                              Nego
      │                                  │
      │  「交渉相手に共有」              │
      │ ──────────────────────────────→ │  Ver.1として表示
      │                                  │
      │                                  │  相手が修正版をアップロード
      │ ←────────────────────────────── │
      │  Hubbleに自動反映                │
      │  新バージョンとして追加          │
      │                                  │
      │  Hubbleで修正して再共有          │
      │ ──────────────────────────────→ │  新バージョンとして表示
      │                                  │
```

### 7.2 ルール
1. **Hubbleからの共有** → Negoに新バージョンとして反映
2. **Negoでの相手の修正** → Hubbleに新バージョンとして自動反映
3. **バージョン番号は各システムで独立** - Hubble Ver.5 = Nego Ver.3 などになりうる

---

## 8. Nego側の表示（Hubble連携時）

招待された交渉相手から見たNego画面。基本的には通常のNego画面と同じだが、一部表示が異なる。

### 8.1 違い

| 項目 | Nego単体 | Hubble連携時 |
|------|---------|-------------|
| 契約書オーナー表示 | 「〇〇さん」 | 「〇〇さん（Hubble経由）」バッジ |
| アップロード | 両者可能 | 両者可能（Hubble側に自動同期） |

---

## 9. デモファイル対応表

| 画面 | ファイル | 説明 |
|------|---------|------|
| Hubble（初回共有前） | hubble-ui-first-share.html | 交渉開始前 |
| Hubble（交渉中） | hubble-ui.html | 交渉バナー付き |
| Nego交渉画面 | negotiation.html | 交渉相手との画面 |
| 署名画面 | sign.html | 署名専用画面 |

---

## 10. 想定ユースケース

### 10.1 典型的なシナリオ

1. **法務部門がHubbleで契約書を作成・レビュー**
   - 社内コメントで法務チーム内の議論
   - 「先方に送って大丈夫です」のコメント

2. **営業担当が「交渉相手に共有」をクリック**
   - 招待モーダルで取引先担当者のメールを入力
   - 招待送信

3. **取引先担当者がNegoで契約書を確認**
   - AI解説を見ながら内容理解
   - 修正版をアップロード

4. **Hubbleに修正版が自動反映**
   - 法務部門がHubble上で差分確認
   - 社内コメントで修正対応を議論

5. **署名手続き・契約締結**
   - Nego上で署名手続き・設定を実行（→ PRD_Common.md 参照）
   - 全署名者の署名完了で契約締結
   - Hubbleのステータスも「締結済み」に更新

---

**Document Version:** 2.0
**Last Updated:** 2026-02-09
